<?php

//include ('get.php');
//include ('post.php');
include ('functions.php')

$id1 = 6482964;
$id2 = 6482963;
$id3 = 6482746;
$id4 = 6482740;
$id5 = 6482586;

 // inputs manuais a cada antecipação que será feita:
$array_transaction_ids_pagarme = array($id1, $id5, $id2, $id3, $id4);
$payment_date = 1560168000*1000;

// parâmetros a serem imputados manualmente:
$recipient_id_fcv_balcao = 're_cjwglmsqq007lwv6delav097k';
$recipient_id_fcv_querobolsa = 're_cjwglwkp4009ewp6d9u7xp9im';
$build = true;  //true = simulação de antecipação; false = antecipação é criada (sem volta)
$pagarme_api_token_sandbox = "Basic YWtfdGVzdF9PSzVYU3hObFE3WU5sNXpRaEtSRHlGQzkyTVhjZk86eA==";


// inicialização das variáveis
$array_payable_ids_fcv_balcao = array();
$array_payable_ids_fcv_querobolsa = array();
$requested_amount_balcao = 0;
$requested_amount_querobolsa = 0;

$i = 0;
$length_array_transactions = sizeof($array_transaction_ids_pagarme);

while ($i<$length_array_transactions){
  $payable_response = get_transaction_payables($array_transaction_ids_pagarme[$i]);
  $payable_response = json_decode($payable_response);
	$j = 0;
	$length_payable_repsonse = sizeof($payable_response);

	while($j < 	$length_payable_repsonse){

		if( $payable_response[$j]->recipient_id == $recipient_id_fcv_balcao){
			 array_push($array_payable_ids_fcv_balcao,$payable_response[$j]->id);
			 $requested_amount_balcao = $requested_amount_balcao + $payable_response[$j]->amount;
		}
		else if ($payable_response[$j]->recipient_id == $recipient_id_fcv_querobolsa){
      		array_push($array_payable_ids_fcv_querobolsa, $payable_response[$j]->id);
			$requested_amount_querobolsa = $requested_amount_querobolsa + $payable_response[$j]->amount;
	   }

		$j = $j + 1;
  }
  
	$i = $i + 1;
}

//var_dump($array_payable_ids_fcv_balcao);
//var_dump($array_payable_ids_fcv_querobolsa);

$array_payable_ids_fcv_balcao_string = implode(",", $array_payable_ids_fcv_balcao);
$array_payable_ids_fcv_querobolsa_string = implode(",", $array_payable_ids_fcv_querobolsa);

//print ("Array como string: ".$array_payable_ids_fcv_balcao_string);
//print ("Array como string: ".$array_payable_ids_fcv_querobolsa_string);


create_anticipation($recipient_id_fcv_balcao,$build,$payment_date,$requested_amount_balcao,$array_payable_ids_fcv_balcao,$pagarme_api_token_sandbox);
create_anticipation($recipient_id_fcv_querobolsa,$build,$payment_date,$requested_amount_querobolsa,$array_payable_ids_fcv_querobolsa,$pagarme_api_token_sandbox);

?>
